<!DOCTYPE html>
<html>
	<head>
		<title>Marketplace</title>
		<script src="main.js" type="text/javascript"></script>
		<script src="masonry.pkgd.min.js"></script>
		<style>
			.grid-item { width: 200px }
		</style>
	</head>
	<body>
		<div id="root"></div>
		<div id="bottom"></div>
		<script type="text/javascript">
			// Set up Elm runtime
			var root = document.getElementById("root");
			var app = Elm.embed(Elm.Main, root, {lastItemVisible : false});

		  // Infinite Scroll	
      function isElementInViewport (el) {
          var rect = el.getBoundingClientRect();
      
          return (
              rect.top >= 0 &&
              rect.left >= 0 &&
              rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /*or $(window).height() */
              rect.right <= (window.innerWidth || document.documentElement.clientWidth) /*or $(window).width() */
          );
      }
      
      window.onscroll = function () {
      	var lastItem = document.getElementById("bottom");
      
      	if (isElementInViewport(lastItem)) {
      		app.ports.lastItemVisible.send(true);
      	}
      	else {
      		app.ports.lastItemVisible.send(false);
      	}
      };

			app.ports.masonry.subscribe(redrawMasonry);

			function redrawMasonry(b) {
				console.log("Masonry TRIGGER");
				var elm = document.querySelector('.grid');
				var msnry = new Masonry( elm, {
					itemSelector: '.grid-item',
					columnWidth: 200
				});
				var msnry = new Masonry( '.grid', {
				});
			}
		</script>
	</body>
</html>	
